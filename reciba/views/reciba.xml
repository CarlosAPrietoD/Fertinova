<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record model="ir.ui.view" id="reciba_ticket_form_view">
            <field name="name">reciba.ticket.form</field>
            <field name="model">reciba.ticket</field>
            <field name="arch" type="xml">
                <form string="Reciba Form">
                    <header>
                        <button name="confirm_reciba" type="object" states="draft" string="Confirmar" class="btn-primary"/>
                        <button name="cancel_reciba" type="object" states="draft" string="Cancelar" />
                        <button name="create_purchase_order" type="object" string="Crear PO" attrs="{'invisible':['|',('price_flag', '=', False),'|',('state', '!=', 'confirmed'),('po_id', '!=', False)]}" class="btn-primary"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,invoiced,cancel" />
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="operation_type" attrs="{'readonly':[('state', '!=', 'draft')]}" />
                                <field name="name" readonly="1" force_save="1"/>
                                <field name="date" readonly="1" />
                                <field name="weigher" attrs="{'readonly':['|',('state', '!=', 'draft'),('operation_type', '=', False)]}" />
                                <field name="company_id" invisible="1"/>
                                <field name="partner_id" string="Proveedor" attrs="{'readonly':['|',('state', '!=', 'draft'),('weigher', '=', False)],'invisible':[('operation_type', '!=', 'in')]}" />
                                <field name="partner_id" string="Cliente" attrs="{'readonly':['|',('state', '!=', 'draft'),('weigher', '=', False)],'invisible':[('operation_type', '!=', 'out')]}" />
                                <field name="product_id" attrs="{'readonly':['|',('state', '!=', 'draft'),('partner_id', '=', False)]}" />
                            </group>
                        </group>
                        <group>
                            <field name="quality_id" string="Norma de calidad" attrs="{'readonly':['|', ('state', '!=', 'draft'),('product_id', '=', False)]}" />
                            
                        </group>
                        <group>
                            <group>
                                <field name="humidity" attrs="{'readonly':['|', ('state', '!=', 'draft'),('product_id', '=', False)]}" />
                                <field name="impurity" attrs="{'readonly':['|',('state', '!=', 'draft'),('product_id', '=', False)]}" />
                            </group>
                            <group>
                                <field name="humidity_discount" attrs="{'invisible':[('apply_discount', '=', False)]}" force_save="1"/>
                                <field name="impurity_discount" attrs="{'invisible':[('apply_discount', '=', False)]}" force_save="1"/>
                            </group>
                            <field name="params_id" attrs="{'readonly':['|',('state', '!=', 'draft'),('impurity', '=', 0)]}">
                                <tree editable="bottom" decoration-danger="value &gt; max_value">
                                    <field name="quality_params_id" readonly="True" force_save="1" />
                                    <field name="max_value" />
                                    <field name="unit" />
                                    <field name="value" />
                                </tree>
                            </field>
                        </group>
                        <group>
                            <field name="driver" attrs="{'readonly':['|',('state', '!=', 'draft'),('product_id', '=', False)]}" />
                            <field name="type_vehicle" attrs="{'readonly':['|', ('state', '!=', 'draft'),('driver', '=', False)]}" />
                            <field name="plate_vehicle" attrs="{'readonly':['|',('state', '!=', 'draft'),('type_vehicle', '=', False)]}" />
                            <field name="plate_trailer" attrs="{'readonly':[('state', '!=', 'draft')],
                            'invisible':[('type_vehicle', '!=', 'trailer'),('type_vehicle', '!=', 'full')]}"/>
                            <field name="plate_second_trailer" attrs="{'readonly':[('state', '!=', 'draft')],
                            'invisible':[('type_vehicle', '!=', 'full')]}"/>
                        </group>

                        <group>
                            <field name="reception" attrs="{'readonly':['|','|','|',('state', '=', 'cancel'),('state', '=', 'invoiced'),('plate_vehicle', '=', False),('price_flag', '=',True)]}" />
                        </group>

                        <group>
                            <group>
                                <field name="provider_location_id" attrs="{'readonly':['|',('state', '!=', 'draft'),('reception', '=', False)]}" />
                                <field name="location_id" attrs="{'readonly':['|',('state', '!=', 'draft'),('provider_location_id', '=', False)]}" />
                            </group>
                            <group>
                                <field name="provider_date"/>
                                <field name="location_date" />
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="gross_weight" attrs="{'readonly':['|',('state', '!=', 'draft'),('location_id', '=', False)]}" />
                                <field name="tare_weight" attrs="{'readonly':['|',('state', '!=', 'draft'),('gross_weight', '=', 0)]}" />
                                <field name="net_weight"/>
                            </group>
                            <group>
                                <field name="gross_date" />
                                <field name="tare_date" />
                                <field name="net_date" />
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="apply_discount" />
                                <field name="humidity_total_discount" attrs="{'invisible':[('apply_discount', '=', False)]}" force_save="1"/>
                                <field name="impurity_total_discount" attrs="{'invisible':[('apply_discount', '=', False)]}" force_save="1"/>
                                <field name="discount" attrs="{'invisible':[('apply_discount', '=', False)]}" force_save="1"/>
                                <field name="total_weight" attrs="{'invisible':[('apply_discount', '=', False)]}" force_save="1"/>
                            </group>
                            <group>
                                <field name="price" attrs="{'readonly':['|','|',('state', '=', 'cancel'),('state', '=', 'invoiced'),('price_flag','=',True)], 'required':[('reception', '=', 'price')], 
                                'invisible':[('reception', '!=', 'price')]}" />
                                <field name="price_flag" invisible="1"/>
                                <field name="currency_id" attrs="{'readonly':[('state', '!=', 'draft')], 'invisible':[('reception', '!=', 'price')]}" />
                                <field name="sub" attrs="{'invisible':[('reception', '!=', 'price')]}"/>
                                <field name="total" attrs="{'invisible':[('reception', '!=', 'price')]}"/>
                            </group>
                        </group>
                        <group>
                            <field name="picking_id" readonly="1" force_save="1"/>
                            <field name="po_id" readonly="1" force_save="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>



        <record model="ir.ui.view" id="reciba_ticket_tree_view">
            <field name="name">reciba.ticket.tree</field>
            <field name="model">reciba.ticket</field>
            <field name="arch" type="xml">
                <tree string="Reciba Tree">
                    <field name="name" />
                    <field name="operation_type" />
                    <field name="product_id" />
                    <field name="provider_location_id" string="Ubicación origen"/>
                    <field name="location_id" string="Ubicación destino"/>
                    <field name="reception" />
                    <field name="net_weight" sum="Total"/>
                    <field name="humidity_total_discount" sum="Total"/>
                    <field name="impurity_total_discount" sum="Total"/>
                    <field name="total_weight" sum="Total"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="reciba_ticket_action">
            <field name="name">Boletas</field>
            <field name="res_model">reciba.ticket</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">Create the first ticket
                </p>
            </field>
        </record>



        <!-- Top menu item -->
        <menuitem name="Reciba" id="menu_reciba_root" sequence="40" />

        <menuitem id="inventory_menu" name="Inventario" parent="menu_reciba_root" sequence="1" />

        <menuitem id="inventory_ticket_menu" name="Boletas" parent="inventory_menu" action="reciba_ticket_action" sequence="1" />


        <record model="ir.ui.view" id="reciba_quality_form_view">
            <field name="name">reciba.quality.form</field>
            <field name="model">reciba.quality</field>
            <field name="arch" type="xml">
                <form string="Reciba Form">
                    <sheet>
                        <group>
                            <field name="name" />
                            <field name="product_id" />
                        </group>
                        <group>
                            <field name="params">
                                <tree string="Quality Tree" editable="bottom">
                                    <field name="name" />
                                    <field name="value" />
                                    <field name="unit" />
                                </tree>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="reciba_quality_tree_view">
            <field name="name">reciba.quality.tree</field>
            <field name="model">reciba.quality</field>
            <field name="arch" type="xml">
                <tree string="Quality Tree">
                    <field name="name" />
                    <field name="product_id" />
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="reciba_quality_action">
            <field name="name">Parametros de calidad</field>
            <field name="res_model">reciba.quality</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">Create the first Param
                </p>
            </field>
        </record>

        <menuitem id="inventory_quality_menu" name="Parametros de calidad" parent="inventory_menu" action="reciba_quality_action" sequence="2" />

    </data>

    <!--==================================================================================================================
    =============================================Boleta con precio========================================================
    ===================================================================================================================-->

    <template id="report_ticket">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="docs" t-as="ticket">
                    <br />
                    <div style="width: 100%;">
                        <table style="width: 100%; text-align: left;">
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Proveedor</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].partner_id.name" />
                                </td>
                                <td style="width: 50%;" rowspan="7">
                                   
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Producto</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].product_id.name" />
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Chofer</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].driver" />
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Placas unidad</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].plate_vehicle" />
                                </td>
                            </tr>
                            <tr t-if="ticket['ticket'].type_vehicle == 'trailer' or ticket['ticket'].type_vehicle == 'full'">
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Placas trailer</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].plate_trailer" />
                                </td>
                            </tr>
                            <tr t-if="ticket['ticket'].type_vehicle == 'full'">
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Placas segundo trailer</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].plate_second_trailer" />
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Pesador</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].weigher" />
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                            </tr>
                        </table>
                    </div>

                    <br />
                    <br />
                    <label>Parametros de calidad</label>
                    <br />

                    <div style="display: flex; padding-top: 20px; width: 100%;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%;">
                                    <table style="width: 100%; text-align: left;">
                                        <tr t-foreach="ticket['ticket'].params_id" t-as="param">
                                            <th style="width: 25%;">
                                                <t t-esc="param.quality_params_id.name" />
                                            </th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="param.value" />
                                            </td>
                                            <td style="width: 10%;">
                                                <t t-esc="param.unit" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 50%;">
                                    <table style="width: 100%; text-align: left;">
                                        <tr>
                                            <th style="width: 25%;">Humedad</th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="ticket['ticket'].humidity" />
                                            </td>
                                            <td style="width: 10%;">%</td>
                                        </tr>
                                        <tr>
                                            <th style="width: 25%;">Impureza</th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="ticket['ticket'].impurity" />
                                            </td>
                                            <td style="width: 10%;">%</td>
                                        </tr>
                                        <tr>
                                            <th style="width: 25%;">Peso neto analizado</th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="ticket['ticket'].total_weight" />
                                            </td>
                                            <td style="width: 10%;">Kg</td>
                                        </tr>
                                        <tr>
                                            <th style="width: 25%;">Precio</th>
                                            <t t-if="ticket['ticket'].price">
                                                <td style="width: 15%; border-bottom: black 1px solid;">
                                                    $
                                                    <t t-esc="ticket['ticket'].total_weight" />
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td style="width: 15%; border-bottom: black 1px solid;">
                                                    Por asignar</td>
                                            </t>

                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div style="width: 100%; padding-top: 150px;">
                        <table style="width: 100%; text-align: center;">
                            <tr>
                                <th style="width: 33%; ">
                                    <div style="width: 94%; margin-left: 3%; margin-right: 3%; border-top: black 1px solid;">
                                        Analista</div>
                                </th>
                                <th style="width: 33%; ">
                                    <div style="width: 94%; margin-left: 3%; margin-right: 3%; border-top: black 1px solid;">
                                        Proveedor/Chofer</div>
                                </th>
                                <th style="width: 33%; ">
                                    <div style="width: 94%; margin-left: 3%; margin-right: 3%; border-top: black 1px solid;">
                                        Sello</div>
                                </th>
                            </tr>
                        </table>
                    </div>

                </t>
            </t>
        </t>
    </template>

    <report id="report_reciba_custom" string="Imprimir boleta con precio" model="reciba.ticket" report_type="qweb-html" name="reciba.report_ticket" />

    <!--==================================================================================================================
    =============================================Boleta sin precio========================================================
    ===================================================================================================================-->

    <template id="report_ticket_priceless">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-foreach="docs" t-as="ticket">
                    <br />
                    <div style="width: 100%;">
                        <table style="width: 100%; text-align: left;">
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Proveedor</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].partner_id.name" />
                                </td>
                                <td style="width: 50%;" rowspan="7">
                                   
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Producto</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].product_id.name" />
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Chofer</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].driver" />
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Placas unidad</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].plate_vehicle" />
                                </td>
                            </tr>
                            <tr t-if="ticket['ticket'].type_vehicle == 'trailer' or ticket['ticket'].type_vehicle == 'full'">
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Placas trailer</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].plate_trailer" />
                                </td>
                            </tr>
                            <tr t-if="ticket['ticket'].type_vehicle == 'full'">
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Placas segundo trailer</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].plate_second_trailer" />
                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%; padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    Pesador</th>
                                <td style="width: 30%;  padding-top: 5px; padding-bottom: 5px; border-bottom: solid 1px black;">
                                    <t t-esc="ticket['ticket'].weigher" />
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                            </tr>
                        </table>
                    </div>

                    <br />
                    <br />
                    <label>Parametros de calidad</label>
                    <br />

                    <div style="display: flex; padding-top: 20px; width: 100%;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%;">
                                    <table style="width: 100%; text-align: left;">
                                        <tr t-foreach="ticket['ticket'].params_id" t-as="param">
                                            <th style="width: 25%;">
                                                <t t-esc="param.quality_params_id.name" />
                                            </th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="param.value" />
                                            </td>
                                            <td style="width: 10%;">
                                                <t t-esc="param.unit" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td style="width: 50%;">
                                    <table style="width: 100%; text-align: left;">
                                        <tr>
                                            <th style="width: 25%;">Humedad</th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="ticket['ticket'].humidity" />
                                            </td>
                                            <td style="width: 10%;">%</td>
                                        </tr>
                                        <tr>
                                            <th style="width: 25%;">Impureza</th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="ticket['ticket'].impurity" />
                                            </td>
                                            <td style="width: 10%;">%</td>
                                        </tr>
                                        <tr>
                                            <th style="width: 25%;">Peso neto analizado</th>
                                            <td style="width: 10%; border-bottom: black 1px solid;">
                                                <t t-esc="ticket['ticket'].total_weight" />
                                            </td>
                                            <td style="width: 10%;">Kg</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div style="width: 100%; padding-top: 150px;">
                        <table style="width: 100%; text-align: center;">
                            <tr>
                                <th style="width: 33%; ">
                                    <div style="width: 94%; margin-left: 3%; margin-right: 3%; border-top: black 1px solid;">
                                        Analista</div>
                                </th>
                                <th style="width: 33%; ">
                                    <div style="width: 94%; margin-left: 3%; margin-right: 3%; border-top: black 1px solid;">
                                        Proveedor/Chofer</div>
                                </th>
                                <th style="width: 33%; ">
                                    <div style="width: 94%; margin-left: 3%; margin-right: 3%; border-top: black 1px solid;">
                                        Sello</div>
                                </th>
                            </tr>
                        </table>
                    </div>

                </t>
            </t>
        </t>
    </template>

    <report id="report_reciba_custom_priceless" string="Imprimir boleta sin precio" model="reciba.ticket" report_type="qweb-html" name="reciba.report_ticket_priceless" />

    <!--==================================================================================================================
    ======================================================Entregas========================================================
    ===================================================================================================================-->

    <record id="view_stock_picking_reciba" model="ir.ui.view">
        <field name="name">view_stock_picking_reciba</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_toggle_is_locked']" position="after">
                <button name="create_reciba" type="object" string="Crear boleta" class="btn-primary" attrs="{'invisible':['|',('state', '!=', 'done'),('reciba_id', '!=', False)]}"/>   
            </xpath>
            <xpath expr="//field[@name='origin']" position="after">
                <field name="reciba_id" />
            </xpath>
        </field>
    </record>

    <!--<record id="reciba_stock_picking" model="ir.ui.view">
        <field name="name">stock.picking.tree.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='scheduled_date']" position="after">
                <field name="reciba_qty"/>
            </xpath>          
        </field>
    </record>-->

</odoo>