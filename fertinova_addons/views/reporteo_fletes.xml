<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <!--
    # /////////////////////////////////////////////////////////////////////////////
    #
    #   Development to create a new PDF report from Odoo Studio View 
    #   "Líneas de Pedido de Ventas" where also it was necessary add
    #   new custom fields.
    #
    #   Also it was created a new Report {List View} and PDF for Management
    #   of Fleets (with new custom fields too)
    #
    # /////////////////////////////////////////////////////////////////////////////
    -->

    <!--This inherited view is just present at the system via Odoo Studio
        it was added a new many2many field for credit notes--> 
    <record id="sale_order_line_inherited_fletes" model="ir.ui.view">
        <field name="name">Odoo Studio: sale.order.line.form.readonly customization.inherit</field>
        <field name="model">sale.order.line</field>
        <field name="inherit_id" ref="studio_customization.odoo_studio_sale_ord_5ca3ac37-4383-48f3-be12-6bf5adee41ba"/>
        <field name="arch" type="xml">
           <xpath expr="//field[@name='invoice_lines']" position="after">
                <field name="credit_notes_ids">
                    <tree string="Notas de Crédito">
                        <field name="invoice_id" string="Referencia Nota Crédito"/>
                        <field name="x_studio_fecha_de_factura" string="Fecha Nota Crédito"/>
                        <field name="name"/>
                        <field name="account_id" groups="account.group_account_user"/>
                        <field name="quantity"/>
                        <field name="uom_id" groups="uom.group_uom"/>
                        <field name="price_unit"/>
                        <field name="discount" groups="sale.group_discount_per_so_line"/>
                        <field name="price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <field name="x_studio_estado_de_la_factura"/>
                        <field name="price_total" groups="account.group_show_line_subtotals_tax_included"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="factura_origen_credito"/>                        
                    </tree>                
                </field>
            </xpath>        
        </field>
    </record>

    <!--Stock Picking Form Inherited where 2 new fields were added: Placas & Operador-->
    <record id="stock_picking_form_inherit_fletes" model="ir.ui.view">
        <field name="name">stock.picking.form.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>	
        <field name="arch" type="xml">
            <field name="origin" position="after">
                <field name="operador"/>
                <field name="placas"/>
                <field name="folio_peso_tk"/>
            </field>           
        </field>
    </record> 

    <!--Stock Quant List Inherited where new field was added: Cantidad Disponible-->
    <record id="stock_picking_form_inherit_fletes" model="ir.ui.view">
        <field name="name">stock.quant.tree.inherit</field>
        <field name="model">stock.quant</field>
        <field name="inherit_id" ref="stock.view_stock_quant_tree"/>	
        <field name="arch" type="xml">
            <field name="quantity" position="after">
                <field name="cant_disponible"/>
            </field>           
        </field>
    </record>     

    <!--Purchase Order Form Inherited where new field was added: Ordenes de Servicio-->
    <record id="purchase_order_form_inherit_fletes" model="ir.ui.view">
        <field name="name">purchase.order.form.inherit</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>	
        <field name="arch" type="xml">
            <field name="company_id" position="after">
                <field name="wbn_service_order_ids" widget="many2many_tags"/>
            </field>           
        </field>
    </record>         


    <!--::::::::::::::::::::::::::::::::::::::::::::-->
    <!--     VIEWS                                  -->
    <!--::::::::::::::::::::::::::::::::::::::::::::-->  

    <!-- Wobin Services Orders - LIST VIEW -->
    <record id="view_wbn_service_orders_list" model="ir.ui.view">
      <field name="name">wobin.service.order.list</field>
      <field name="model">wobin.service.order</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name"/>
          <field name="partner_id"/>
          <field name="create_date"/>                 
          <field name="estado"/>  
          <field name="purchase_with_order_id"/> 
        </tree>
      </field>
    </record>   

    <!-- Wobin Services Orders - FORM VIEW -->
    <record id="view_wbn_service_orders_form" model="ir.ui.view"> 
        <field name="name">wobin.service.order.form</field> 
        <field name="model">wobin.service.order</field> 
        <field name="arch" type="xml"> 
            <form> 
                <header>
                    <button string="Cancelar" name="cancelar_orden" type="object" class="oe_highlight"/>
                    <field name="estado" widget="statusbar" statusbar_visible="asignada,no_asignada,cancelada"/>
                </header>
                <sheet> 
                    <div class="oe_left oe_title">
                        <h1>
                            <field name="name" readonly="True"/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="partner_id" required="True"/>                 
                        </group>                                                 
                        <group>                                                              
                        </group> 
                    </group> 
                    
                    <field name="pickings_ids">
                        <tree editable="bottom">
                            <field name="transferencia_origen_id"/>
                            <field name="fecha_carga_origen"/>
                            <field name="producto_id"/>
                            <field name="folio_peso_tk_tr_ori"/>
                            <field name="kilos_origen" sum="Total Kilos Origen"/>
                            <field name="transferencia_destino_id"/>
                            <field name="fecha_descarga_destino"/>
                            <field name="producto_destino_id"/>
                            <field name="folio_peso_tk_tr_dest"/>
                            <field name="kilos_destino" sum="Total Kilos Destino"/>
                            <field name="placas"/>
                            <field name="operador"/>
                            <field name="dif_merma_excedente"/>
                            <field name="tolerancia"/>
                            <field name="tolerancia_ajustada"/>
                            <field name="tolerancia_autorizada"/>
                            <field name="tolerancia_excedida"/>
                            <field name="tarifas"/>
                            <field name="subtotal_antes_desc"/>
                            <field name="precio_producto"/>
                            <field name="desc_tolerancia_exced"/>
                            <field name="importe" sum="Total Importe"/>
                            <field name="iva"/>
                            <field name="retencion"/>
                            <field name="total" sum="Total"/>
                        </tree>
                    </field>                     
                                                             
                </sheet>              
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>               
            </form> 
        </field> 
    </record>


    <!-- Wobin Services Orders Lines - LIST VIEW -->
    <record id="view_wbn_service_orders_lns_list" model="ir.ui.view">
      <field name="name">wobin.service.order.list</field>
      <field name="model">wobin.service.order.line</field>
      <field name="arch" type="xml">
            <tree>
                <field name="wbn_service_order_id"/>
                <field name="estado_wbn_servi_ord"/>
                <field name="wbn_pur_order_related"/>
                <field name="transferencia_origen_id"/>
                <field name="fecha_carga_origen"/>
                <field name="producto_id"/>
                <field name="folio_peso_tk_tr_ori"/>
                <field name="kilos_origen"/>
                <field name="transferencia_destino_id"/>
                <field name="fecha_descarga_destino"/>
                <field name="producto_destino_id"/>
                <field name="folio_peso_tk_tr_dest"/>
                <field name="kilos_destino"/>
                <field name="placas"/>
                <field name="operador"/>  
                <field name="dif_merma_excedente"/>                          
                <field name="tolerancia"/>
                <field name="tolerancia_ajustada"/>
                <field name="tolerancia_autorizada"/>
                <field name="tolerancia_excedida"/>
                <field name="tarifas"/>
                <field name="subtotal_antes_desc"/>
                <field name="precio_producto"/>
                <field name="desc_tolerancia_exced"/>
                <field name="importe"/>
                <field name="iva"/>
                <field name="retencion"/>
                <field name="total"/>
            </tree>
      </field>
    </record> 

    <!-- Wobin Services Orders Lines - FORM VIEW -->
    <record id="view_wbn_service_orders_lns_form" model="ir.ui.view"> 
        <field name="name">wobin.service.order.line.form</field> 
        <field name="model">wobin.service.order.line</field> 
        <field name="arch" type="xml"> 
            <form> 
                <header>
                    <field name="estado_wbn_servi_ord" widget="statusbar" statusbar_visible="asignada,no_asignada,cancelada"/>
                </header>
                <sheet> 
                    <div class="oe_left oe_title">
                        <h1>
                            <field name="wbn_service_order_id" readonly="True"/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="wbn_pur_order_related" readonly="True"/>                 
                        </group>                                                 
                        <group>                                                              
                        </group> 
                    </group> 


                    <group>

                        <div class="container border border-info m-2" style="border-radius: 10px;">
                          <div style="margin-top: 27px !important;">
                            <div style="padding-top: 30px !important;">
                                <h5 style="background: #fff none repeat scroll 0 0; height: auto; margin-left: 20px; padding: 3px 5px; position: absolute; margin-top: -47px; border: 1px solid #337ab7; border-radius: 8px;"><strong>Movimiento Origen</strong></h5>                    
                                <group>
                                    <field name="transferencia_origen_id"/>
                                    <field name="fecha_carga_origen"/>
                                    <field name="producto_id"/>
                                    <field name="folio_peso_tk_tr_ori"/>
                                    <field name="kilos_origen"/>                           
                                </group>   
                            </div>  
                          </div> 
                        </div>

                        <div class="container border border-info m-2" style="border-radius: 10px;">
                          <div style="margin-top: 27px !important;">
                            <div style="padding-top: 30px !important;">
                                <h5 style="background: #fff none repeat scroll 0 0; height: auto; margin-left: 20px; padding: 3px 5px; position: absolute; margin-top: -47px; border: 1px solid #337ab7; border-radius: 8px;"><strong>Movimiento Destino</strong></h5>                                                                                                                          
                                <group>  
                                    <field name="transferencia_destino_id"/>
                                    <field name="fecha_descarga_destino"/>
                                    <field name="producto_destino_id"/>
                                    <field name="folio_peso_tk_tr_dest"/>
                                    <field name="kilos_destino"/>
                                    <field name="placas"/>
                                    <field name="operador"/>  
                                    <field name="dif_merma_excedente"/>                          
                                    <field name="tolerancia"/>
                                    <field name="tolerancia_ajustada"/>
                                    <field name="tolerancia_autorizada"/>
                                    <field name="tolerancia_excedida"/>
                                    <field name="tarifas"/>
                                    <field name="subtotal_antes_desc"/>
                                    <field name="precio_producto"/>
                                    <field name="desc_tolerancia_exced"/>
                                    <field name="importe"/>
                                    <field name="iva"/>
                                    <field name="retencion"/>
                                    <field name="total"/>                                                                                   
                                </group> 
                            </div>  
                          </div> 
                        </div> 

                    </group> 

                </sheet>  

                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>  

            </form> 
        </field> 
    </record>    


    <!--::::::::::::::::::::::::::::::::::::::::::::-->
    <!--   ACTIONS                                  -->
    <!--::::::::::::::::::::::::::::::::::::::::::::-->

    <!-- Wobin Services Orders - GENERAL ACTION -->
    <record id="action_wbn_service_orders" model="ir.actions.act_window">
      <field name="name">Ordenes de Servicio</field>
      <field name="res_model">wobin.service.order</field>
      <field name="view_mode">tree,form</field>
    </record>

    <!-- Wobin Services Orders Lines - GENERAL ACTION -->
    <record id="action_wbn_service_orders_lns" model="ir.actions.act_window">
      <field name="name">Rerpote Ordenes de Servicio</field>
      <field name="res_model">wobin.service.order.line</field>
      <field name="view_mode">tree,form</field>
    </record> 



    <!--::::::::::::::::::::::::::::::::::::::::::::-->
    <!--   SUB MENUITEMS                            -->
    <!--::::::::::::::::::::::::::::::::::::::::::::--> 
    <!-- New Menuitem at Inventory > Operations -->
    <menuitem 
        name="Ordenes de Servicio" 
        id="menu_stock_wbn_serv_ord" 
        action="action_wbn_service_orders" 
        parent="stock.menu_stock_warehouse_mgmt" 
        sequence="400"/>

    <!-- New Menuitem at Inventory > Reporting -->
    <menuitem 
        name="Reporte Ordenes de Servicio" 
        id="menu_report_wbn_serv_ord_lns" 
        action="action_wbn_service_orders_lns" 
        parent="stock.menu_warehouse_report" 
        sequence="200"/> 

    <!-- New Menuitem at Sales > Reporting -->
    <menuitem 
        name="Reporte Ordenes de Servicio" 
        id="menu_2_report_wbn_serv_ord_lns" 
        action="action_wbn_service_orders_lns" 
        parent="sale.menu_sale_report" 
        sequence="200"/> 

  </data>


  <data noupdate="1">
        <!--::::::::::::::::::::::::::::::::::::::::::::-->
        <!-- SEQUENCE for name of Wobin Service Orders  -->
        <!--::::::::::::::::::::::::::::::::::::::::::::-->
        <record id="sequence_wobin_serv_orders" model="ir.sequence">
        <field name="name">Wobin Service Orders</field>
        <field name="code">self.orden_servicio</field>
        <field name="active">TRUE</field>
        <field name="prefix">ORD</field>
        <field name="padding">6</field>
        <!--<field name="number_next">1</field>-->
        <field name="number_increment">1</field>
        </record>             
  </data>   

</odoo> 
